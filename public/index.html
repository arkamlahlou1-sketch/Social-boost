<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialBoost - Free Followers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Cairo', sans-serif; }
        .card { background: #1e293b; border: 1px solid #334155; }
        .modal-bg { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(5px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="auth-modal" class="fixed inset-0 modal-bg flex items-center justify-center z-50 hidden">
        <div class="card p-8 rounded-3xl w-full max-w-sm text-center border-blue-500/30">
            <h2 class="text-2xl font-black mb-4 text-blue-500">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!</h2>
            <p class="text-gray-400 text-sm mb-6">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¨Ø¯Ø¡ Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</p>
            <input id="username-input" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl mb-4 outline-none focus:border-blue-500 text-center">
            <button onclick="registerUser()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-bold transition">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†</button>
        </div>
    </div>

    <div class="max-w-md mx-auto">
        
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-black text-blue-500 italic">SOCIALBOOST</h1>
            <div class="bg-yellow-500/10 border border-yellow-500/20 px-4 py-1 rounded-full text-yellow-500 font-bold">
                ğŸ’° <span id="user-points text-xl">0</span>
            </div>
        </div>

        <div id="tasks-container">
            <p class="text-gray-500 text-center py-10">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ø§Ù… Ù…ØªØ§Ø­Ø©...</p>
        </div>

        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 rounded-3xl shadow-xl mb-6 mt-6">
            <h3 class="font-bold text-lg mb-1">ğŸ Ù‡Ø¯Ø§ÙŠØ§ Ù…Ø¬Ø§Ù†ÙŠØ©!</h3>
            <p class="text-blue-100 text-xs mb-4">Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø·Ùƒ ÙˆØ§Ù†Ø´Ø±Ù‡ Ù„ØªØ±Ø¨Ø­ 50 Ù†Ù‚Ø·Ø© Ø¹Ù† ÙƒÙ„ ØµØ¯ÙŠÙ‚.</p>
            <div class="flex items-center gap-2 bg-white/10 p-2 rounded-xl border border-white/20">
                <button onclick="copyRefLink()" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-bold text-xs">Ù†Ø³Ø®</button>
                <input id="ref-link" type="text" readonly value="https://rosroys-jpg.github.io/?ref=user" class="bg-transparent border-none text-white text-xs w-full outline-none">
            </div>
        </div>

        <div class="card p-6 rounded-3xl shadow-xl mb-6">
            <h3 class="font-bold mb-4 flex items-center gap-2 text-blue-400">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
            <div id="leaderboard-list" class="space-y-3">
                <div class="flex justify-between text-xs text-gray-400">
                    <span>Ù‚Ø±ÙŠØ¨Ø§Ù‹.. ÙƒÙ† Ø£Ù†Øª Ø§Ù„Ø£ÙˆÙ„!</span>
                </div>
            </div>
        </div>

        <div class="text-center pb-10">
            <a href="#" onclick="Swal.fire('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ÙÙˆØ± ÙˆØµÙˆÙ„Ùƒ Ù„Ù€ 500 Ù†Ù‚Ø·Ø©', 'info')" class="text-blue-400 hover:text-white text-sm font-medium underline">ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</a>
        </div>
    </div>

    <script>
        const API_URL = "https://social-boost-production.up.railway.app/api";
        let currentUser = JSON.parse(localStorage.getItem('sb_user')) || null;
        let timerId;

        // 1. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        async function registerUser() {
            const username = document.getElementById('username-input').value;
            if(!username) return Swal.fire('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');

            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username, email: username + "@social.com" })
                });
                const user = await res.json();
                localStorage.setItem('sb_user', JSON.stringify(user));
                location.reload();
            } catch (e) {
                Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Railway', 'error');
            }
        }

        // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function init() {
            if(!currentUser) {
                document.getElementById('auth-modal').classList.remove('hidden');
                return;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
            const userRes = await fetch(`${API_URL}/user/${currentUser.id}`);
            const userData = await userRes.json();
            document.getElementById('user-points').innerText = userData.points_balance;
            document.getElementById('ref-link').value = `https://rosroys-jpg.github.io/?ref=${userData.username}`;

            loadTasks();
        }

        // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        async function loadTasks() {
            const container = document.getElementById('tasks-container');
            const res = await fetch(`${API_URL}/tasks/${currentUser.id}`);
            const tasks = await res.json();

            if(tasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø£Ø¶Ù Ø­Ù…Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰!</p>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="card p-6 rounded-3xl shadow-xl mb-4">
                    <div class="flex items-center justify-between gap-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-tr from-blue-500 to-indigo-500 rounded-full flex items-center justify-center font-bold text-xl uppercase">${task.target_link.charAt(0)}</div>
                            <div>
                                <p class="font-bold text-sm truncate w-24">${task.target_link}</p>
                                <p class="text-green-400 text-xs">+${task.points_per_follow} Ù†Ù‚Ø·Ø©</p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <a href="${task.target_link}" target="_blank" onclick="startTimer(${task.id})" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl text-xs font-bold transition text-center">Ù…ØªØ§Ø¨Ø¹Ø©</a>
                            <button id="btn-${task.id}" disabled class="bg-slate-700 opacity-50 px-6 py-2 rounded-xl text-xs font-bold">ØªØ£ÙƒÙŠØ¯ (30s)</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function startTimer(taskId) {
            let time = 30;
            const btn = document.getElementById(`btn-${taskId}`);
            if (timerId) clearInterval(timerId);

            timerId = setInterval(() => {
                time--;
                btn.innerText = `ØªØ£ÙƒÙŠØ¯ (${time}s)`;
                if (time <= 0) {
                    clearInterval(timerId);
                    btn.disabled = false;
                    btn.className = "bg-green-600 hover:bg-green-500 px-6 py-2 rounded-xl text-xs font-bold transition";
                    btn.innerText = "ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù† âœ…";
                    btn.onclick = () => confirmTask(taskId);
                }
            }, 1000);
        }

        async function confirmTask(taskId) {
            const res = await fetch(`${API_URL}/tasks/verify`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ userId: currentUser.id, taskId: taskId })
            });
            const result = await res.json();
            if(result.success) {
                Swal.fire('Ù…Ø¨Ø±ÙˆÙƒ!', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${result.new_points} Ù†Ù‚Ø·Ø©`, 'success').then(() => location.reload());
            } else {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', result.error, 'warning');
            }
        }

        function copyRefLink() {
            const linkInput = document.getElementById('ref-link');
            linkInput.select();
            document.execCommand('copy');
            Swal.fire('ØªÙ… Ø§Ù„Ù†Ø³Ø®!', 'Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„ØªØ±Ø¨Ø­', 'success');
        }

        window.onload = init;
    </script>
</body>
</html>
